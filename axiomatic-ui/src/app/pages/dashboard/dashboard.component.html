<div class="dashboard-container">
  <h1>DASHBOARD</h1>

  <section class="input-section">
    <h2>Enter or upload asset details in JSON format</h2>
    <label for="jsonFileUpload">Upload JSON file:</label>
    <input
      id="jsonFileUpload"
      type="file"
      (change)="loadFile($event)"
      accept=".json"
      style="margin-bottom: 1rem"
    />
    <textarea
      [(ngModel)]="jsonInput"
      rows="15"
      placeholder="Paste here your JSON input..."
    ></textarea>

    <div class="cta-row">
      <button
        mat-raised-button
        color="primary"
        class="btn-primary"
        (click)="sendRequest()"
      >
        Send to Oracle
      </button>

      <mat-spinner *ngIf="loading" diameter="32"></mat-spinner>
    </div>
  </section>

  <section *ngIf="errorMessage && !response" class="error-section">
    <mat-card class="error-card" color="warn">
      <strong>Error:</strong>
      <pre>{{ errorMessage }}</pre>
    </mat-card>
  </section>

  <section class="output-section" *ngIf="response && !errorMessage">
    <h2 class="output-title">Valutazione AI:</h2>

    <p>
      <strong>Esteemed value:</strong>
      {{ response.metrics?.valuation_base_k * 1000 | currency : "EUR" }}
    </p>

    <p
      *ngIf="
        response?.metrics?.valuation_base_k &&
        response?.model_health?.metrics?.mae_k
      "
    >
      <strong>Confidence (± MAE):</strong>
      {{
        getConfidenceInterval(
          response.metrics.valuation_base_k,
          response.model_health.metrics.mae_k
        )[0] | currency : "EUR"
      }}
      –
      {{
        getConfidenceInterval(
          response.metrics.valuation_base_k,
          response.model_health.metrics.mae_k
        )[1] | currency : "EUR"
      }}
    </p>

    <p>
      <strong>Model:</strong>
      {{ response.model_meta?.value_model_name }} (v{{
        response.model_meta?.value_model_version
      }})
    </p>

    <p>
      <strong>State:</strong>
      {{ response.model_health?.status }}
    </p>

    <p *ngIf="txId">
      <strong>Transaction ID:</strong>
      <a [href]="getExplorerUrl(txId)" target="_blank">{{ txId }}</a>
    </p>

    <div class="cta-row">
      <button
        mat-stroked-button
        color="accent"
        class="btn-primary btn-label"
        (click)="publishToBlockchain()"
      >
        Publish on Algorand
      </button>
      <button
        mat-stroked-button
        color="primary"
        class="btn-primary btn-label"
        (click)="downloadResponse()"
        [disabled]="!response"
      >
        Download Response
      </button>
    </div>
  </section>
</div>
